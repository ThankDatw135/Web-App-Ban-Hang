# Database Schema (ERD)

> Complete Entity Relationship Diagram cho Luxury Fashion Platform

---

## ğŸ“Š ERD Diagram (Text-based)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATABASE SCHEMA - ERD                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   ADMIN_USERS   â”‚
                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                              â”‚ * id (PK)       â”‚
                              â”‚   email         â”‚
                              â”‚   password_hash â”‚
                              â”‚   role          â”‚
                              â”‚   permissions   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     USERS       â”‚                                         â”‚   CATEGORIES    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ * id (PK)       â”‚                                         â”‚ * id (PK)       â”‚
â”‚   email         â”‚                                         â”‚   name          â”‚
â”‚   password      â”‚                                         â”‚   slug          â”‚
â”‚   full_name     â”‚                                         â”‚   parent_id(FK) â”‚â”€â”€â”
â”‚   phone         â”‚                                         â”‚   image_url     â”‚  â”‚
â”‚   firebase_uid  â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   role          â”‚                                                  â”‚           â”‚
â”‚   is_active     â”‚                                                  â”‚ 1:N       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â–¼           â”‚
         â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚                                                  â”‚    PRODUCTS     â”‚  â”‚
         â”‚ 1:N                                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
         â–¼                                                  â”‚ * id (PK)       â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚   name          â”‚<â”€â”˜
â”‚ USER_ADDRESSES  â”‚                                         â”‚   slug          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                         â”‚   category_id   â”‚
â”‚ * id (PK)       â”‚                                         â”‚   base_price    â”‚
â”‚   user_id (FK)  â”‚                                         â”‚   images (JSON) â”‚
â”‚   label         â”‚                                         â”‚   featured      â”‚
â”‚   address_line1 â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   city          â”‚                                                  â”‚
â”‚   is_default    â”‚                                                  â”‚ 1:N
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â–¼
         â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ 1:N                                              â”‚PRODUCT_VARIANTS â”‚
         â–¼                                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚ * id (PK)       â”‚
â”‚   CART_ITEMS    â”‚       â”‚    REVIEWS      â”‚               â”‚   product_id(FK)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚   sku           â”‚
â”‚ * id (PK)       â”‚       â”‚ * id (PK)       â”‚               â”‚   size          â”‚
â”‚   user_id (FK)â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”‚   user_id (FK)  â”‚               â”‚   color         â”‚
â”‚   product_id(FK)â”‚       â”‚   product_id(FK)â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   stock         â”‚
â”‚   variant_id(FK)â”‚â”€â”€â”€â”€â”€â”€â”€â”‚   rating        â”‚               â”‚   price         â”‚
â”‚   quantity      â”‚       â”‚   content       â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
         â”‚                                                           â”‚
         â”‚ 1:N                                                       â”‚
         â–¼                                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   WISHLISTS     â”‚       â”‚    DISCOUNTS    â”‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚ * id (PK)       â”‚       â”‚ * id (PK)       â”‚                        â”‚
â”‚   user_id (FK)  â”‚       â”‚   code          â”‚                        â”‚
â”‚   product_id(FK)â”‚       â”‚   discount_type â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   discount_valueâ”‚                        â”‚
                          â”‚   min_purchase  â”‚                        â”‚
                          â”‚   max_uses      â”‚                        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                                   â”‚                                 â”‚
                                   â”‚ 1:N                             â”‚
                                   â–¼                                 â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
                          â”‚ DISCOUNT_USAGE  â”‚                        â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
                          â”‚   discount_id   â”‚                        â”‚
                          â”‚   user_id       â”‚                        â”‚
                          â”‚   order_id      â”‚                        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ORDERS      â”‚       â”‚   ORDER_ITEMS   â”‚       â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚                â”‚
â”‚ * id (PK)       â”‚       â”‚ * id (PK)       â”‚       â”‚                â”‚
â”‚   user_id (FK)  â”‚       â”‚   order_id (FK) â”‚<â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚   order_number  â”‚â”€â”€â”€â”€â”€â”€>â”‚   product_id(FK)â”‚                        â”‚
â”‚   subtotal      â”‚       â”‚   variant_id(FK)â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   discount_amt  â”‚       â”‚   product_name  â”‚
â”‚   total_amount  â”‚       â”‚   quantity      â”‚
â”‚   status        â”‚       â”‚   unit_price    â”‚
â”‚   shipping_addr â”‚       â”‚   total_price   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:1
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    PAYMENTS     â”‚                          â”‚ USER_ACTIVITIES â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ * id (PK)       â”‚                          â”‚ * id (PK)       â”‚
â”‚   order_id (FK) â”‚                          â”‚   user_id (FK)  â”‚
â”‚   payment_methodâ”‚                          â”‚   activity_type â”‚
â”‚   status        â”‚                          â”‚   reference_typeâ”‚
â”‚   amount        â”‚                          â”‚   reference_id  â”‚
â”‚   transaction_idâ”‚                          â”‚   metadata(JSON)â”‚
â”‚   paid_at       â”‚                          â”‚   ip_address    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRYON_SESSIONS  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ * id (PK)       â”‚
â”‚   user_id (FK)  â”‚
â”‚   user_image_urlâ”‚
â”‚   product_ids   â”‚
â”‚   result_img_urlâ”‚
â”‚   status        â”‚
â”‚   processing_ms â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Tables Summary

| #   | Table                | Description                       | Key Relations                         |
| --- | -------------------- | --------------------------------- | ------------------------------------- |
| 1   | **users**            | User accounts                     | â†’ addresses, cart, orders, activities |
| 2   | **user_addresses**   | Multiple addresses per user       | â†’ users                               |
| 3   | **admin_users**      | Admin accounts (separate)         | -                                     |
| 4   | **categories**       | Product categories (hierarchical) | â†’ products, self-reference            |
| 5   | **products**         | Product catalog                   | â†’ categories, variants                |
| 6   | **product_variants** | Size/Color combinations           | â†’ products                            |
| 7   | **cart_items**       | Shopping cart                     | â†’ users, products, variants           |
| 8   | **orders**           | Order headers                     | â†’ users, payments                     |
| 9   | **order_items**      | Order line items                  | â†’ orders, products, variants          |
| 10  | **payments**         | Payment transactions              | â†’ orders                              |
| 11  | **discounts**        | Discount codes                    | â†’ discount_usage                      |
| 12  | **discount_usage**   | Track usage per user              | â†’ discounts, users, orders            |
| 13  | **user_activities**  | Activity history                  | â†’ users                               |
| 14  | **tryon_sessions**   | AI try-on history                 | â†’ users                               |
| 15  | **wishlists**        | User wishlists                    | â†’ users, products                     |
| 16  | **reviews**          | Product reviews                   | â†’ users, products, orders             |

---

## ğŸ”— Key Relationships

```
users (1) â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€ (N) user_addresses
               â”œâ”€â”€â”€â”€â”€ (N) cart_items
               â”œâ”€â”€â”€â”€â”€ (N) orders
               â”œâ”€â”€â”€â”€â”€ (N) wishlists
               â”œâ”€â”€â”€â”€â”€ (N) reviews
               â”œâ”€â”€â”€â”€â”€ (N) user_activities
               â””â”€â”€â”€â”€â”€ (N) tryon_sessions

categories (1) â”€â”€â”€â”€â”€â”€â”€â”€ (N) products
                              â”‚
                              â””â”€â”€â”€ (N) product_variants

orders (1) â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€ (N) order_items
               â””â”€â”€â”€â”€â”€ (1) payments

discounts (1) â”€â”€â”€â”€â”€â”€â”€â”€ (N) discount_usage
```

---

## ğŸ“Œ Status Enums

### Order Status

```
pending â†’ confirmed â†’ processing â†’ shipped â†’ delivered
                                         â†˜ cancelled
                                         â†˜ refunded
```

### Payment Status

```
pending â†’ processing â†’ completed
                    â†˜ failed
                    â†˜ refunded
```

### Activity Types

```
view_product, add_to_cart, remove_from_cart, checkout,
place_order, cancel_order, search, login, logout,
register, update_profile, try_on
```

---

## ğŸ“„ Schema File

Full SQL schema: [database/schema.sql](file:///e:/Web-App-Ban-Hang/Web-App-Ban-Hang/database/schema.sql)

---

**â›” STEP 2 â€” DATABASE DESIGN COMPLETE**
